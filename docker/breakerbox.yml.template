breakerbox:
  urls: {{ .Env.BREAKERBOX_URL }}
  initialDelay: 0s
  delay: 60s

archaiusOverride:
  hystrixMetricsStreamServletMaxConnections: {{ .Env.TURBINE_HYSTRIX_METRICS_STREAM_SERVLET_MAX_CONNECTIONS }}
  turbineHostRetry: {{ .Env.TURBINE_HOST_RETRY }}
  turbineLatencyThreshold: {{ .Env.TURBINE_LATENCY_THRESHOLD }}
  turbineSkipLineDelay: {{ .Env.TURBINE_SKIP_LINE_DELAY }}

defaultDashboard: {{ .Env.DEFAULT_DASHBOARD }}

{{ if $.Secrets.AZURE_ACCOUNT }}
azure:
  accountName: {{ $.Secrets.AZURE_ACCOUNT }}
  accountKey: {{ $.Secrets.AZURE_KEY }}
  timeout: 2s 
  retryInterval: 500ms
  retryAttempts: 1 

{{ else }}

database:
  driverClass: org.h2.Driver
  url: jdbc:h2:mem:inMemory;DB_CLOSE_DELAY=-1
  user: breakerbox
  password: breakerboxpass
  maxSize: 10
  minSize: 2
  checkConnectionWhileIdle: true
  validationInterval: 30s
{{ end }}

tenacityClient:
  connectionTimeout: 500ms

ldap:
  uri: {{ .Env.LDAP_URI }}
  cachePolicy: maximumSize=10000,expireAfterWrite=15m
  userFilter: ou=people,dc=yammer,dc=com
  groupFilter: ou=groups,dc=yammer,dc=com
  userNameAttribute: cn
  groupNameAttribute: cn
  groupMembershipAttribute: memberUid
  restrictToGroups:
    - eng
  connectTimeout: 500ms
  readTimeout: 5s

chute:
  uri: {{ .Env.CHIPPER_URL }}
  hostname: breakerbox
  connectionTimeout: 500ms
  timeout: 10s
  tags:
    ip: {{ .Env.HOST }}
    port: {{ .Env.PORTS }}
    region: {{ .Env.REGION }}

metaClusters:
  - PRODUCTION
  - STAGE
  - STAGING

logging:
  level: INFO
  appenders:
    - type: logstash-file
      threshold: INFO
      currentLogFilename: logs/breakerbox-json.log
      archive: false
      timeZone: UTC
      customFields:
        region: {{ .Env.REGION }}
        docker_host: {{ .Env.HOST }}
        docker_port: {{ .Env.PORTS }}
        git_sha: {{ .Env.GIT_SHA }}
        source: breakerbox

server:
  applicationConnectors:
    - type: http
      port: 8080
  adminConnectors:
    - type: http
      port: 8081
  gzip:
    enabled: false
  requestLog:
    appenders:
      - type: file
        currentLogFilename: logs/requests.log
        archive: false
